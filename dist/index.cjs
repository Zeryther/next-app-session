var e=require("nanoid"),t=require("cookie-signature"),r=require("next/headers");function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var i=/*#__PURE__*/n(t),o=/*#__PURE__*/function(){function e(){this.store=void 0,this.store=new Map}var t=e.prototype;return t.get=function(e){try{var t,r=this,n=r.store.get(e),i=function(){if(n){var i=function(e){return t?e:(t=1,o)},o=JSON.parse(n,function(e,t){return"expires"===e?new Date(t):t}),s=function(n){if(null!=(n=o.cookie)&&n.expires&&o.cookie.expires.getTime()<=Date.now())return Promise.resolve(r.destroy(e)).then(function(){return t=1,null})}();return s&&s.then?s.then(i):i(s)}}();return Promise.resolve(i&&i.then?i.then(function(e){return t?e:null}):t?i:null)}catch(e){return Promise.reject(e)}},t.set=function(e,t){try{return this.store.set(e,JSON.stringify(t)),Promise.resolve()}catch(e){return Promise.reject(e)}},t.destroy=function(e){try{return this.store.delete(e),Promise.resolve()}catch(e){return Promise.reject(e)}},t.touch=function(e,t){try{return this.store.set(e,JSON.stringify(t)),Promise.resolve()}catch(e){return Promise.reject(e)}},e}(),s=/*#__PURE__*/function(){function t(r,n,i){return this.store=void 0,this.cookies=void 0,this.sid=void 0,this.name=void 0,this.secret=void 0,this.genid=void 0,this.cookieOpts=void 0,this.touchAfter=void 0,t.instance?t.instance:(t.instance=this,this.store=r,this.cookies=n,this.name=i.name||"sid",this.secret=i.secret,this.genid=i.genid||e.nanoid,this.cookieOpts=i.cookie,this.touchAfter=i.touchAfter,this.sid=this._getID(),this)}var r=t.prototype;return r._getID=function(){var e,t=this.decode(null==(e=this.cookies.get(this.name))?void 0:e.value);return!t&&this.genid&&(t=this.genid()),t||""},r.encode=function(e){return this.secret&&""!=this.secret?e?"s:"+i.default.sign(e,this.secret||""):"":e},r.decode=function(e){return e&&this.secret&&""!=this.secret?i.default.unsign(e.slice(2),this.secret||"")||null:e||null},r.all=function(){try{var e;return Promise.resolve(null==(e=this.store)?void 0:e.get(this.sid)).then(function(e){return null!=e?e:{}})}catch(e){return Promise.reject(e)}},r.get=function(e){try{return Promise.resolve(this.all()).then(function(t){var r;return null!=(r=null==t?void 0:t[e])?r:null})}catch(e){return Promise.reject(e)}},r.has=function(e){try{return Promise.resolve(this.all()).then(function(t){return!(null==t||!t[e])&&""!==(null==t?void 0:t[e])})}catch(e){return Promise.reject(e)}},r.set=function(e,t){try{var r=this;return Promise.resolve(r.all()).then(function(n){return n||(n={}),n[e]=t,Promise.resolve(r.setAll(n)).then(function(){})})}catch(e){return Promise.reject(e)}},r.setAll=function(e){try{var t=function(){return console.log("setAll",e),Promise.resolve(r.store.set(r.sid,e)).then(function(){})},r=this,n=r.cookies.get(r.name),i=function(){var e,t,i,o,s,u;if(null==n||!n.value||""==n.value)return Promise.resolve(r.cookies.set(r.name,r.encode(r.sid),{path:(null==(e=r.cookieOpts)?void 0:e.path)||"/",httpOnly:null==(t=null==(i=r.cookieOpts)?void 0:i.httpOnly)||t,domain:(null==(o=r.cookieOpts)?void 0:o.domain)||void 0,sameSite:null==(s=r.cookieOpts)?void 0:s.sameSite,secure:(null==(u=r.cookieOpts)?void 0:u.secure)||!1})).then(function(){})}();return Promise.resolve(i&&i.then?i.then(t):t())}catch(e){return Promise.reject(e)}},r.destroy=function(e){try{var t=this,r=e?Promise.resolve(t.all()).then(function(r){return delete r[e],Promise.resolve(t.setAll(r)).then(function(){})}):Promise.resolve(t.setAll({})).then(function(){});return Promise.resolve(r&&r.then?r.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},t}();s.instance=void 0,exports.AppSession=s,exports.MemoryStore=o,exports.default=function(e){var t=e.store||new o;return function(){return new s(t,r.cookies(),e)}};
//# sourceMappingURL=index.cjs.map
